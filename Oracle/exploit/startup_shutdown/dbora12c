#! /bin/sh  
# chkconfig: 345 99 10
# description: Control of the database and listener startup/shutdown
# -------------------------------------------------------------------------
# Fichier : dbora
#
# Auteur : LMR
# Societe: ASTEK
# Date : 27/01/2014
# Application : 
# Version : 1.0.0
# Description : Arret/redemarrage des bases oracle au boot
# Emplacement : /home/oracle/init.d/
#
# Mise en place:
#		mkdir -p /home/oracle/init.d/
#       cd /home/oracle/init.d/
#       svn export http://svn.c2ms.net/bdd/trunk/oracle/script/linux/init.d/dbora12c
#
#		mv dbora12c dbora
#		chown -R oracle.dba /home/oracle/init.d/
#		chmod +x /home/oracle/init.d/dbora
#		cp /home/oracle/init.d/dbora.service /lib/systemd/system/dbora.service
#		ln -s /lib/systemd/system/dbora.service /etc/systemd/system/dbora.service
#		systemctl daemon-reload
#		systemctl start dbora.service
#		systemctl enable dbora.service
#		Parametrage de ORA_HOME:/app/oracle/product/12c  
#	        ps -ef | grep smon |grep -v grep | awk {'print "/proc/"$2"/environ"'} | xargs cat | xargs -0 -n1 |grep ORACLE_HOME
#		Parametrage /etc/oratab 
#
#
# Modifications :
#	1.0.0 <27/01/2014> <LMR> : <Creation>
#	1.0.1 <27/01/2014> <LMR> : <Modification utilisation de dbstart/dbshut >
#	1.0.2 <08/09/2015> <LMR> : <Modification 12c >
# -------------------------------------------------------------------------

. /home/oracle/.bash_profile

. /home/oracle/dbaoraenv.sh HOME


ORA_HOME=/app/oracle/product/12c
ORA_OWNER=oracle
export ORACLE_UNQNAME=db12c

if [ ! -f $ORA_HOME/bin/dbstart ]
then
    echo "Oracle startup: cannot start"
    exit
fi

case "$1" in
    'start')
        # Start the Oracle databases:
        # The following command assumes that the oracle login 
        # will not prompt the user for any values
        # Remove "&" if you don't want startup as a background process.
        $ORA_HOME/bin/dbstart $ORA_HOME
        touch $ORA_HOME/dbora.lock
        ;;
    'stop')
        # Stop the Oracle databases:
        # The following command assumes that the oracle login 
        # will not prompt the user for any values
        $ORA_HOME/bin/dbshut $ORA_HOME
        rm -f $ORA_HOME/dbora.lock
        ;;
esac
